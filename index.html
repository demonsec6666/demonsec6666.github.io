<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Demon - Secist</title><meta name="author" content="Demon"><meta name="copyright" content="Demon"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="没有绝对安全的系统">
<meta property="og:type" content="website">
<meta property="og:title" content="Demon">
<meta property="og:url" content="https://www.ggsec.cn/index.html">
<meta property="og:site_name" content="Demon">
<meta property="og:description" content="没有绝对安全的系统">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://demonsec666.oss-cn-qingdao.aliyuncs.com/default_avatar.jpg">
<meta property="article:author" content="Demon">
<meta property="article:tag" content="kali|linux|sec|Web|MSF|Win">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://demonsec666.oss-cn-qingdao.aliyuncs.com/default_avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.ggsec.cn/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Demon',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2025-04-26 08:18:49'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Demon" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/default_avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">146</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa-sharp fa-solid fa-pen"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://demonsec666.oss-cn-qingdao.aliyuncs.com/%E5%A3%81%E7%BA%B8.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Demon</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa-sharp fa-solid fa-pen"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Demon</h1><div id="site-subtitle"><span id="subtitle"></span></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/page.html" title="page"><img class="post_bg" src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/default_cover2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="page"></a></div><div class="recent-post-info"><a class="article-title" href="/page.html" title="page">page</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2025-04-26T00:15:33.000Z" title="发表于 2025-04-26 08:15:33">2025-04-26</time></span></div><div class="content"></div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/YourCyanide_CMD-Based%20Ransomware.html" title="基于CMD勒索脚本混淆分析"><img class="post_bg" src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/hack-like-pro-spy-anyone-part-1-hacking-computers.1280x600.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于CMD勒索脚本混淆分析"></a></div><div class="recent-post-info"><a class="article-title" href="/YourCyanide_CMD-Based%20Ransomware.html" title="基于CMD勒索脚本混淆分析">基于CMD勒索脚本混淆分析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-08-14T03:07:41.000Z" title="发表于 2022-08-14 11:07:41">2022-08-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/windows/">windows</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/">恶意样本分析</a></span></div><div class="content">

在这篇博文中，我们将分析 YourCyanide，它是基于 CMD 的勒索软件系列的最新变体，始于 GonnaCope。YourCyanide 是一种复杂的勒索软件，它集成了 PasteBin、Discord 和 Microsoft 文档链接，作为其payload下载的一部分。YourCyanide 包含多层混淆，并利用自定义环境变量和启用延迟扩展功能来隐藏其活动。作为其规避策略的一部分，YourCyanide 还将通过不同的文件，通过 Discord 和 Pastebin 下载后续文件，然后最终下载主要有效负载。使用vscode打开混淆脚本后，可以看到该代码为批处理脚本，同时为多处混淆内容。这些环境变量，因为这些值周围有两个%的百分比符号，比如%jVElq:20,1%。接下来是设定值，这些基本上是数字值将从其索引并根据值返回字符或字符串的字母，从jVElq设置变量来看。打开cmd窗口，复制粘贴jVElq的变量，然后使用echo再去打印“%jVElq:20,1%”，打印的结果为e。在vscode中按住ctrl+F使用查找并点击下图红框的按钮进行正则匹配“%jVElq:~[0-9]+ ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/obfuscation_from_Excel_VBA_2.html" title="obfuscation_from_Excel_VBA_Part2"><img class="post_bg" src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/python-bundle-can-teach-you-everything-you-need-know.1280x600.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="obfuscation_from_Excel_VBA_Part2"></a></div><div class="recent-post-info"><a class="article-title" href="/obfuscation_from_Excel_VBA_2.html" title="obfuscation_from_Excel_VBA_Part2">obfuscation_from_Excel_VBA_Part2</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-07T10:36:38.000Z" title="发表于 2022-01-07 18:36:38">2022-01-07</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/windows/">windows</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/">恶意样本分析</a></span></div><div class="content">

继续分析 4 个要下载的文件的列表。

下载到本地继续分析。

下载文件后，它将使用该函数提取每个像素以及 B 和 G 颜色值，进行数学运算然后作为字符输出。之后，它将传递从像素解码的 base64 字符串和 ([System.Version]).”nAME” 的结果，其计算结果为“Version”。该值用作解密中的密钥。解密函数将使用派生密钥函数中 base64 编码数据的前 32 个字节。它还将使用传递的键值。HMAC 部分并不是真正需要正确解密数据。然后我们使用 RijndaelManaged 解密。如果数据被正确解密，我们就会得到第一个字节 0x1F。这也告诉我们，无需查看其余代码，这就是 GZip 压缩数据输出。虽然仍在解密函数中，但它会在返回另一个 base64 字符串之前对数据进行 GZip 解压缩。
更改脚本，更改为本地地址搭建个http服务端，再接着删除&amp;(&quot;&#123;1&#125;&#123;0&#125;&quot; -f &#39;X&#39;,&#39;IE&#39;)字符，因该函数为iex执行，删除后就可以直接输出结果。


输出内容 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/obfuscation-from-Excel-VBA.html" title="obfuscation_from_Excel_VBA_Part1"><img class="post_bg" src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/python-bundle-can-teach-you-everything-you-need-know.1280x600.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="obfuscation_from_Excel_VBA_Part1"></a></div><div class="recent-post-info"><a class="article-title" href="/obfuscation-from-Excel-VBA.html" title="obfuscation_from_Excel_VBA_Part1">obfuscation_from_Excel_VBA_Part1</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-06T12:50:38.000Z" title="发表于 2022-01-06 20:50:38">2022-01-06</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/windows/">windows</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/">恶意样本分析</a></span></div><div class="content">


查看文档，看到有禁用宏的警告
使用oletools剥离出宏代码
简单的可以看出多个十六进制拼接后转为字符串后执行。


简单的整理拼接后

输出十六进制

转char字符串，将十六进制解码为字符串后，我们现在发现我们面临一个 PowerShell 脚本，该脚本是 Invoke Dosfuscation ，经过混淆。可参考以下原理和链接

https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/dosfuscation-report.pdf
https://i.blackhat.com/briefings/asia/2018/asia-18-bohannon-invoke_dosfuscation_techniques_for_fin_style_dos_level_cmd_obfuscation.pdf
参考以上把call改为echo
输出以下红框处。
代码整理后如下：
还有一层混淆，将其修改为以下powershell代码将其base64代入：
1234567891011$base64data = &quot;inser ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/HANCITOR-WITH-COBALT-STRIKE.html" title="HANCITOR_WITH_COBALT_STRIKE"><img class="post_bg" src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/use-msfconsoles-generate-command-obfuscate-payloads-evade-antivirus-detection.1280x600.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HANCITOR_WITH_COBALT_STRIKE"></a></div><div class="recent-post-info"><a class="article-title" href="/HANCITOR-WITH-COBALT-STRIKE.html" title="HANCITOR_WITH_COBALT_STRIKE">HANCITOR_WITH_COBALT_STRIKE</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-10-17T01:02:14.000Z" title="发表于 2021-10-17 09:02:14">2021-10-17</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/windows/">windows</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/">恶意样本分析</a></span></div><div class="content">

下载大神抓到的样本与流量。点开查看邮件，与流量包。邮件中下载doc，而使用olevba对doc分析宏，而宏中加载了dll，也就是说rundll32 kikus.dll,GBSLWSDVGOE。同时可以看到该文档隐藏了一个对象。拖到x32dbg中进行动态分析第一个阶段的payload。下几个断点。断到断点处进过几次的对EAX内存转储，可以看到像MZ一样的头。往下走点就可以看到真正的pe头文件了。保存转储后的文件，第二个阶段的payload。丢到010编辑器中，并搜索4d 5a，发现在436fh中。将其余前面部分删除。拖到pestudio中，可以在导出表中看到真正的函数入口点。拖到IDA中，找到函数入口。进入sub_10001870函数。sub_10001AA0获取计算机信息，获取外网ip，发送c2服务器。sub_100025B0函数复制一些字符串。sub_10002CD0函数。第二个阶段的payload重新拖到x32dbg中，设置sub_100025B0和sub_10002CD0的虚拟地址为断点，断到断点处在eax中对其进行内存转储。发现转储的内容为下图几个地址。并可以看到对其往外发 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/Confucius.html" title="魔罗桫组织与 Pegasus 间谍软件"><img class="post_bg" src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/learn-c-start-designing-games-apps.1280x600.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="魔罗桫组织与 Pegasus 间谍软件"></a></div><div class="recent-post-info"><a class="article-title" href="/Confucius.html" title="魔罗桫组织与 Pegasus 间谍软件">魔罗桫组织与 Pegasus 间谍软件</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-09-20T23:01:11.000Z" title="发表于 2021-09-21 07:01:11">2021-09-21</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/windows/">windows</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/">恶意样本分析</a></span></div><div class="content">


1.起源APT组织”魔罗桫”（又名为Confucius），是一个长期针对中国，巴基斯坦，尼泊尔等地区，主要瞄准政府机构，军工企业，核能行业等领域进行网络间谍活动的活跃组织。
此类恶意文档主要通过钓鱼邮件进行传播，用户打开该恶意文档后，显示的是看似正常的相关报告，背后会通过office宏从黑客的服务端下载恶意文件并隐蔽执行，最终受害用户计算机被黑客组织控制，资料被窃取。恶意word文件打开后实际内容如下。该活动涉及两步攻击。在第一阶段，向目标发送一封没有恶意负载的电子邮件，其中包含从合法的巴基斯坦报纸文章中复制的内容。伪造的发件人地址冒充巴基斯坦武装部队的公关部门 。
两天后，第二封电子邮件（据称是巴基斯坦军方关于 Pegasus 间谍软件的警告）将发送给目标，其中包含指向恶意加密 Word 文档的 cutt.ly 链接和解密密码。发件人地址模拟了类似于第一封电子邮件上的服务。如果目标点击链接或“取消订阅”链接，它将从 parinari[.]xyz 域下载 Word 文档。这些电子邮件要么从巴基斯坦的 ExpressVPN 出口节点发送，要么从攻击者控制下的邮件服务器发送。检查包含 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/decrypting-obfuscated-net-malware-part-2.html" title="decrypting-obfuscated-net-malware-part-2"><img class="post_bg" src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/97ED5073471E2C9EFAC6706C7C6246EC.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="decrypting-obfuscated-net-malware-part-2"></a></div><div class="recent-post-info"><a class="article-title" href="/decrypting-obfuscated-net-malware-part-2.html" title="decrypting-obfuscated-net-malware-part-2">decrypting-obfuscated-net-malware-part-2</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-09-04T23:45:07.000Z" title="发表于 2021-09-05 07:45:07">2021-09-05</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/windows/">windows</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/">恶意样本分析</a></span></div><div class="content">


信息窃取者agenttesla
1.收集用户系统数据1时间、用户、CPU、内存、计算机名称、OSFullName


2.从这些l浏览器列表中中窃取凭据1Opera, Comodo, Google Chrome, CocCoc, Chedot, Elements Browser, Liebao, QIP Surf, Orbitum, Sputnik, CentBrowser, Amigo, SRWare Iron, Torch, Brave, Iridium, CoolNovo, 7Star, Epic Privacy Browser, 360 Chrome, Yandex, QQBrowser , UCBrowser, Kometa, Sleipnir 6, Citrio, Coowon, uCozMedia, Vivaldi, Cyber​​Fox, IceCat, PaleMoon, Falkon Browser, Flock Browser, WaterFox, BlackHawk



3.FTP应用列表窃取凭据1CoreFTP、SmartFTP、WS_FTP、File ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/decrypting-obfuscated-net-malware-part-1.html" title="decrypting-obfuscated-net-malware-part1"><img class="post_bg" src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/97ED5073471E2C9EFAC6706C7C6246EC.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="decrypting-obfuscated-net-malware-part1"></a></div><div class="recent-post-info"><a class="article-title" href="/decrypting-obfuscated-net-malware-part-1.html" title="decrypting-obfuscated-net-malware-part1">decrypting-obfuscated-net-malware-part1</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-09-04T01:53:17.000Z" title="发表于 2021-09-04 09:53:17">2021-09-04</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/windows/">windows</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/">恶意样本分析</a></span></div><div class="content">


1.起因今天正好抽空整理一下前几个月看到阿三的分析视频。https://app.any.run/tasks/0f9b13ab-3efe-4ee1-abc1-a193db2bc33e/
 AgentTesla该恶意样本具有 3 层混淆和少量反分析技术的信息窃取器能够通过通过 SMTP 发送所有收集到的信息来窃取受害者的各种信息。stager 的名称：

IbIDo（包含有payload2 和 3 的加密stager）
AndroidStudio（解密payload 3）
Lazarus（最终payload之前包含少量反分析技术）
NRMOeaUVVkwIAtJShsOH（最终 AgentTesla payload)
下面我们就开始分析各个阶段的stager

2.IbIDo 拖入MV TBN CALL PORT FOR LOADING COAL_pdf.exe到pestudiom，可以看到在version种可以看到信息lbIDo.exe 再使用dnspy反编译调试工具进行分析与调试，找到ibiDO，进入man函数
跟进去找到main窗口，可以看到两个字符串
那么我们回来再看看这个S ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/Telegram%E6%81%B6%E6%84%8F%E5%B9%BF%E5%91%8A%E6%B4%BB%E5%8A%A8%E4%B9%8B%E6%81%B6%E6%84%8F%E4%BB%93%E5%BA%93%E5%88%86%E6%9E%90.html" title="Telegram恶意广告活动之恶意仓库分析"><img class="post_bg" src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/20210319-24.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Telegram恶意广告活动之恶意仓库分析"></a></div><div class="recent-post-info"><a class="article-title" href="/Telegram%E6%81%B6%E6%84%8F%E5%B9%BF%E5%91%8A%E6%B4%BB%E5%8A%A8%E4%B9%8B%E6%81%B6%E6%84%8F%E4%BB%93%E5%BA%93%E5%88%86%E6%9E%90.html" title="Telegram恶意广告活动之恶意仓库分析">Telegram恶意广告活动之恶意仓库分析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-03-19T10:34:14.000Z" title="发表于 2021-03-19 18:34:14">2021-03-19</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/windows/">windows</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/">恶意样本分析</a></span></div><div class="content">


1.起源Jeremy Kirk博主表示在搜索telegram的时候发现有一个有趣的广告

访问链接后，看起来像是telegram的官方网站，做的很逼真，但是其实就是钓鱼网站，当我们查看链接时，我们发现它用恶意软件替换了Windows二进制文件：
指向第三方的链接
1https://bitbucket.org/LLCTRUST/softwarellc/downloads/TelegramInstaller.exe


查看证书，我们可以看到它们是由相同的CA在相同的时间范围内颁发的，这很可能使它们来自同一威胁参与者。
123https://telegramdesktop.com/https://telegramdesktop.net/https://telegramdesktop.org/


当然在博主发完博文的后，我再次查看该网站，发现了它对链接也进行了替换。

2.bitbucker发现在.com网站将其文件分发到bitbucker仓库中（github替代品）。访问仓库时，我们可以收集有关感染，操作日期以及其他恶意软件样本的一些信息：

在该仓库发现如下内容
12345678 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/powershell%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90.html" title="powershell横向渗透样本分析"><img class="post_bg" src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/IMG_20210309_193244.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="powershell横向渗透样本分析"></a></div><div class="recent-post-info"><a class="article-title" href="/powershell%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90.html" title="powershell横向渗透样本分析">powershell横向渗透样本分析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-03-09T10:34:14.000Z" title="发表于 2021-03-09 18:34:14">2021-03-09</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/windows/">windows</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/">恶意样本分析</a></span></div><div class="content">


1.起源前段时间收到一份样本 类似于DLTMiner活动攻击留下的样本，这份样本与2019年DLTMiner及其相似,同时也与近期的exchange服务器相关
同时 Kyle Hanslovan在推文发布一张图，图中有powershell执行代码调用执行url地址的字符串

http[:]&#x2F;&#x2F;p。estonine。com&#x2F;p?e
调用执行的依旧为powershell的代码

2.powershell混淆 解码powershell的混淆,去掉 IEX 或  Invoke-Expression  



解码后解出多次混淆后，下图为最后完整的代码

这里重点内容为 下载执行update。png的内容

updata-png而update。png内容如下


解码混淆两三次后如下图所示

下面重点开始讲这部分的脚本的功能。
3.update-png的功能3.1.永恒之蓝加入了开源脚本的powershell exp

3.2永恒之蓝扫描加入了开源脚本ms17-010scanner.cs

3.3 目标选择随机生成用于定位的IP地址，并在特定端口号上进行端口扫 ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/#content-inner">15</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/default_avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Demon</div><div class="author-info__description">没有绝对安全的系统</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">146</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/demonsec666"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">2022-11-24：博客最近大升级，未来几年应该都保持这个风格。</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/page.html" title="page"><img src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/default_cover2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="page"/></a><div class="content"><a class="title" href="/page.html" title="page">page</a><time datetime="2025-04-26T00:15:33.000Z" title="发表于 2025-04-26 08:15:33">2025-04-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/YourCyanide_CMD-Based%20Ransomware.html" title="基于CMD勒索脚本混淆分析"><img src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/hack-like-pro-spy-anyone-part-1-hacking-computers.1280x600.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于CMD勒索脚本混淆分析"/></a><div class="content"><a class="title" href="/YourCyanide_CMD-Based%20Ransomware.html" title="基于CMD勒索脚本混淆分析">基于CMD勒索脚本混淆分析</a><time datetime="2022-08-14T03:07:41.000Z" title="发表于 2022-08-14 11:07:41">2022-08-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/obfuscation_from_Excel_VBA_2.html" title="obfuscation_from_Excel_VBA_Part2"><img src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/python-bundle-can-teach-you-everything-you-need-know.1280x600.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="obfuscation_from_Excel_VBA_Part2"/></a><div class="content"><a class="title" href="/obfuscation_from_Excel_VBA_2.html" title="obfuscation_from_Excel_VBA_Part2">obfuscation_from_Excel_VBA_Part2</a><time datetime="2022-01-07T10:36:38.000Z" title="发表于 2022-01-07 18:36:38">2022-01-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/obfuscation-from-Excel-VBA.html" title="obfuscation_from_Excel_VBA_Part1"><img src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/python-bundle-can-teach-you-everything-you-need-know.1280x600.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="obfuscation_from_Excel_VBA_Part1"/></a><div class="content"><a class="title" href="/obfuscation-from-Excel-VBA.html" title="obfuscation_from_Excel_VBA_Part1">obfuscation_from_Excel_VBA_Part1</a><time datetime="2022-01-06T12:50:38.000Z" title="发表于 2022-01-06 20:50:38">2022-01-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/HANCITOR-WITH-COBALT-STRIKE.html" title="HANCITOR_WITH_COBALT_STRIKE"><img src="https://demonsec666.oss-cn-qingdao.aliyuncs.com/use-msfconsoles-generate-command-obfuscate-payloads-evade-antivirus-detection.1280x600.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HANCITOR_WITH_COBALT_STRIKE"/></a><div class="content"><a class="title" href="/HANCITOR-WITH-COBALT-STRIKE.html" title="HANCITOR_WITH_COBALT_STRIKE">HANCITOR_WITH_COBALT_STRIKE</a><time datetime="2021-10-17T01:02:14.000Z" title="发表于 2021-10-17 09:02:14">2021-10-17</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/APT/"><span class="card-category-list-name">APT</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/ATT-CK/"><span class="card-category-list-name">ATT&CK</span><span class="card-category-list-count">85</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/C2/"><span class="card-category-list-name">C2</span><span class="card-category-list-count">28</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/CVE/"><span class="card-category-list-name">CVE</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Metasploit/"><span class="card-category-list-name">Metasploit</span><span class="card-category-list-count">32</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/kali/"><span class="card-category-list-name">kali</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/linux/"><span class="card-category-list-name">linux</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/windows/"><span class="card-category-list-name">windows</span><span class="card-category-list-count">19</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/ATT-CK/" style="font-size: 1.5em; color: #99a9bf">ATT&CK</a> <a href="/tags/AutoIt/" style="font-size: 1.1em; color: #999">AutoIt</a> <a href="/tags/C2/" style="font-size: 1.38em; color: #99a4b4">C2</a> <a href="/tags/CVE/" style="font-size: 1.22em; color: #999ea4">CVE</a> <a href="/tags/HID/" style="font-size: 1.18em; color: #999ca1">HID</a> <a href="/tags/Mac/" style="font-size: 1.1em; color: #999">Mac</a> <a href="/tags/Metasploit/" style="font-size: 1.42em; color: #99a6b7">Metasploit</a> <a href="/tags/Windows/" style="font-size: 1.34em; color: #99a3b0">Windows</a> <a href="/tags/kali/" style="font-size: 1.26em; color: #999fa8">kali</a> <a href="/tags/linux/" style="font-size: 1.3em; color: #99a1ac">linux</a> <a href="/tags/windows/" style="font-size: 1.46em; color: #99a7bb">windows</a> <a href="/tags/%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/" style="font-size: 1.34em; color: #99a3b0">恶意样本分析</a> <a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 1.14em; color: #999b9d">逆向</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">八月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/01/"><span class="card-archive-list-date">一月 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/10/"><span class="card-archive-list-date">十月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/09/"><span class="card-archive-list-date">九月 2021</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/03/"><span class="card-archive-list-date">三月 2021</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/02/"><span class="card-archive-list-date">二月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/01/"><span class="card-archive-list-date">一月 2021</span><span class="card-archive-list-count">2</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">146</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2025-04-26T00:18:48.882Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://demonsec666.oss-cn-qingdao.aliyuncs.com/%E5%A3%81%E7%BA%B8.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Demon</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">没有绝对安全的系统</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    window.typed = new Typed("#subtitle", {
      strings: ["即刻安全 Demonsec666","没有绝对安全的系统"],
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50
    })
  } else {
    document.getElementById("subtitle").innerHTML = '即刻安全 Demonsec666'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>